---
title: "Database Tables"
description: "Complete Postgres table definitions for Vector."
---

All tables live in a PostgreSQL database hosted on Railway. Tables are defined as Django models and managed via Django migrations. The SQL below represents the resulting schema.

## Naming conventions

- Table names: `snake_case`, plural (`decisions`, `circle_members`)
- Column names: `snake_case` (`sponsor_person_id`, `workspace_id`)
- Foreign keys: `{entity}_id` (`circle_id`, `initiative_id`)
- Enums: Postgres `text` with `CHECK` constraints
- Timestamps: `timestamptz` with defaults

## Tables

### workspaces

```sql
CREATE TABLE workspaces (
  id          uuid PRIMARY KEY DEFAULT gen_random_uuid(),
  name        text NOT NULL,
  slug        text NOT NULL UNIQUE,
  logo        text,
  created_at  timestamptz NOT NULL DEFAULT now(),
  updated_at  timestamptz NOT NULL DEFAULT now()
);
```

### persons

```sql
CREATE TABLE persons (
  id                       uuid PRIMARY KEY DEFAULT gen_random_uuid(),
  name                     text NOT NULL,
  email                    text NOT NULL UNIQUE,
  initials                 text NOT NULL,
  last_active_workspace_id uuid REFERENCES workspaces(id) ON DELETE SET NULL,
  created_at               timestamptz NOT NULL DEFAULT now(),
  updated_at               timestamptz NOT NULL DEFAULT now()
);
```

The `persons` table stores profile data for people within Vector. In the Django `authentication` app, the `User` model handles login credentials (email/password, JWT), while `persons` holds workspace-visible profile data. A person record is created when a user is invited to a workspace.

### workspace_members

```sql
CREATE TABLE workspace_members (
  workspace_id uuid NOT NULL REFERENCES workspaces(id) ON DELETE CASCADE,
  person_id    uuid NOT NULL REFERENCES persons(id) ON DELETE CASCADE,
  role         text NOT NULL CHECK (role IN ('Admin', 'Member')),
  status       text NOT NULL CHECK (status IN ('Active', 'Disabled')) DEFAULT 'Active',
  created_at   timestamptz NOT NULL DEFAULT now(),
  PRIMARY KEY (workspace_id, person_id)
);
```

| Role | Description |
|---|---|
| `Admin` | Can manage workspace settings, invite/remove people, create/edit circles |
| `Member` | Can view and create entities within the workspace |

| Status | Description |
|---|---|
| `Active` | Normal access |
| `Disabled` | Soft-deleted — historical references preserved, no active access |

### circles

```sql
CREATE TABLE circles (
  id           uuid PRIMARY KEY DEFAULT gen_random_uuid(),
  workspace_id uuid NOT NULL REFERENCES workspaces(id) ON DELETE CASCADE,
  name         text NOT NULL,
  cadence      text NOT NULL CHECK (cadence IN ('Weekly', 'Biweekly', 'Manual')),
  session_day  smallint CHECK (session_day BETWEEN 0 AND 6),
  created_at   timestamptz NOT NULL DEFAULT now(),
  updated_at   timestamptz NOT NULL DEFAULT now()
);
```

| Cadence | Description |
|---|---|
| `Weekly` | Meets every week on `session_day` (0=Monday, 6=Sunday) |
| `Biweekly` | Meets every two weeks on `session_day` |
| `Manual` | Sessions are created manually; `session_day` is null |

### circle_members

```sql
CREATE TABLE circle_members (
  circle_id  uuid NOT NULL REFERENCES circles(id) ON DELETE CASCADE,
  person_id  uuid NOT NULL REFERENCES persons(id) ON DELETE CASCADE,
  role       text NOT NULL CHECK (role IN ('Member', 'Organizer')),
  created_at timestamptz NOT NULL DEFAULT now(),
  PRIMARY KEY (circle_id, person_id)
);
```

| Role | Description |
|---|---|
| `Member` | Can see circle content, be assigned as sponsor or commitment owner, attend sessions |
| `Organizer` | All member capabilities, plus: manage session agendas, schedule decisions, mark sessions completed |

### sessions

```sql
CREATE TABLE sessions (
  id           uuid PRIMARY KEY DEFAULT gen_random_uuid(),
  circle_id    uuid NOT NULL REFERENCES circles(id) ON DELETE CASCADE,
  number       integer NOT NULL,
  title        text NOT NULL,
  date         date NOT NULL,
  decision_ids uuid[] DEFAULT '{}',
  commitment_ids uuid[] DEFAULT '{}',
  notes        text,
  completed    boolean NOT NULL DEFAULT false,
  created_at   timestamptz NOT NULL DEFAULT now(),
  updated_at   timestamptz NOT NULL DEFAULT now(),
  UNIQUE (circle_id, number)
);
```

The `number` column is auto-generated per circle via a trigger (see [Background Jobs & Triggers](/backend/database-functions)). The `UNIQUE (circle_id, number)` constraint ensures no duplicates within a circle.

### initiatives

```sql
CREATE TABLE initiatives (
  id           uuid PRIMARY KEY DEFAULT gen_random_uuid(),
  workspace_id uuid NOT NULL REFERENCES workspaces(id) ON DELETE CASCADE,
  name         text NOT NULL,
  status       text NOT NULL CHECK (status IN ('Planned', 'Active', 'Completed')),
  target_date  text NOT NULL,
  created_at   timestamptz NOT NULL DEFAULT now(),
  updated_at   timestamptz NOT NULL DEFAULT now()
);
```

| Status | Description |
|---|---|
| `Planned` | Defined but work has not started |
| `Active` | In progress — projects are being executed |
| `Completed` | Delivered or closed |

### initiative_circles

```sql
CREATE TABLE initiative_circles (
  initiative_id uuid NOT NULL REFERENCES initiatives(id) ON DELETE CASCADE,
  circle_id     uuid NOT NULL REFERENCES circles(id) ON DELETE CASCADE,
  PRIMARY KEY (initiative_id, circle_id)
);
```

Links circles to an initiative for restricted visibility. If no rows exist, the initiative is visible to all workspace members.

### projects

```sql
CREATE TABLE projects (
  id             uuid PRIMARY KEY DEFAULT gen_random_uuid(),
  workspace_id   uuid NOT NULL REFERENCES workspaces(id) ON DELETE CASCADE,
  initiative_id  uuid NOT NULL REFERENCES initiatives(id) ON DELETE CASCADE,
  name           text NOT NULL,
  lead_person_id uuid NOT NULL REFERENCES persons(id),
  created_at     timestamptz NOT NULL DEFAULT now(),
  updated_at     timestamptz NOT NULL DEFAULT now()
);
```

### project_circles

```sql
CREATE TABLE project_circles (
  project_id uuid NOT NULL REFERENCES projects(id) ON DELETE CASCADE,
  circle_id  uuid NOT NULL REFERENCES circles(id) ON DELETE CASCADE,
  PRIMARY KEY (project_id, circle_id)
);
```

Links circles to a project for restricted visibility. If no rows exist, the project is visible to all workspace members.

### decisions

```sql
CREATE TABLE decisions (
  id                     uuid PRIMARY KEY DEFAULT gen_random_uuid(),
  workspace_id           uuid NOT NULL REFERENCES workspaces(id) ON DELETE CASCADE,
  title                  text NOT NULL,
  description            text,
  status                 text NOT NULL CHECK (status IN ('Draft', 'Requested', 'Scheduled', 'Rolled', 'Taken'))
                           DEFAULT 'Draft',
  circle_id              uuid NOT NULL REFERENCES circles(id),
  requested_by_person_id uuid NOT NULL REFERENCES persons(id),
  requested_date         date,
  sponsor_person_id      uuid REFERENCES persons(id),
  owner_person_id        uuid REFERENCES persons(id),
  initiative_id          uuid REFERENCES initiatives(id) ON DELETE SET NULL,
  project_id             uuid REFERENCES projects(id) ON DELETE SET NULL,
  revisit_of_decision_id uuid REFERENCES decisions(id) ON DELETE SET NULL,
  created_at             timestamptz NOT NULL DEFAULT now(),
  updated_at             timestamptz NOT NULL DEFAULT now()
);
```

| Status | Description |
|---|---|
| `Draft` | Created but not ready for discussion. The requestor is gathering context. |
| `Requested` | Formally submitted to a circle. The age counter starts. Available for an upcoming session. |
| `Scheduled` | On a specific session's agenda. A sponsor has been assigned. |
| `Rolled` | Was on the agenda but not resolved. Carries over to next session. |
| `Taken` | The circle made the call. An owner has been assigned. Decision is closed. |

The decision's age in days is computed in the frontend from `requested_date`. Age is null while the decision is in Draft status.

`requested_date` is auto-set when the decision moves from Draft to Requested.

`sponsor_person_id` is set when the decision is Scheduled. Must be a circle member.

`owner_person_id` is set when the decision is Taken. Tracks long-term validity, can revoke.

### decision_references

```sql
CREATE TABLE decision_references (
  id          uuid PRIMARY KEY DEFAULT gen_random_uuid(),
  decision_id uuid NOT NULL REFERENCES decisions(id) ON DELETE CASCADE,
  type        text NOT NULL CHECK (type IN ('file', 'link')),
  url         text NOT NULL,
  title       text,
  created_at  timestamptz NOT NULL DEFAULT now()
);
```

### commitments

```sql
CREATE TABLE commitments (
  id               uuid PRIMARY KEY DEFAULT gen_random_uuid(),
  workspace_id     uuid NOT NULL REFERENCES workspaces(id) ON DELETE CASCADE,
  title            text NOT NULL,
  description      text,
  status           text NOT NULL CHECK (status IN ('Active', 'At risk', 'Rolled', 'Delivered'))
                     DEFAULT 'Active',
  owner_person_id  uuid NOT NULL REFERENCES persons(id),
  review_circle_id uuid NOT NULL REFERENCES circles(id),
  decision_id      uuid REFERENCES decisions(id) ON DELETE SET NULL,
  due              date NOT NULL,
  created_at       timestamptz NOT NULL DEFAULT now(),
  updated_at       timestamptz NOT NULL DEFAULT now()
);
```

| Status | Description |
|---|---|
| `Active` | On track, being worked on |
| `At risk` | Flagged for potential slippage |
| `Rolled` | Due date passed without delivery |
| `Delivered` | Outcome completed, commitment closed |

### project_updates

```sql
CREATE TABLE project_updates (
  id               uuid PRIMARY KEY DEFAULT gen_random_uuid(),
  project_id       uuid NOT NULL REFERENCES projects(id) ON DELETE CASCADE,
  author_person_id uuid NOT NULL REFERENCES persons(id),
  date             date NOT NULL,
  health           text NOT NULL CHECK (health IN ('On track', 'At risk', 'Off track')),
  content          text NOT NULL,
  created_at       timestamptz NOT NULL DEFAULT now(),
  updated_at       timestamptz NOT NULL DEFAULT now()
);
```

| Health | Description |
|---|---|
| `On track` | Progressing as expected, no blockers |
| `At risk` | Potential delays or blockers that may cause problems |
| `Off track` | Behind schedule or significant issues needing intervention |

### activity_events

```sql
CREATE TABLE activity_events (
  id              uuid PRIMARY KEY DEFAULT gen_random_uuid(),
  workspace_id    uuid NOT NULL REFERENCES workspaces(id) ON DELETE CASCADE,
  actor_person_id uuid NOT NULL REFERENCES persons(id),
  entity_type     text NOT NULL,
  entity_id       uuid NOT NULL,
  action          text NOT NULL,
  metadata        jsonb,
  created_at      timestamptz NOT NULL DEFAULT now()
);
```

Append-only audit trail. Each row records who did what to which entity. The `metadata` JSONB column stores action-specific details (e.g., old/new status, referenced circle or person IDs). The frontend renders each event into a human-readable sentence with clickable links.

No `updated_at` — activity events are never modified.

## Indexes

```sql
-- Workspace-scoped lookups (most common query pattern)
CREATE INDEX idx_circles_workspace ON circles(workspace_id);
CREATE INDEX idx_initiatives_workspace ON initiatives(workspace_id);
CREATE INDEX idx_projects_workspace ON projects(workspace_id);
CREATE INDEX idx_decisions_workspace ON decisions(workspace_id);
CREATE INDEX idx_commitments_workspace ON commitments(workspace_id);

-- Circle content lookups
CREATE INDEX idx_sessions_circle ON sessions(circle_id);
CREATE INDEX idx_decisions_circle ON decisions(circle_id);
CREATE INDEX idx_commitments_review_circle ON commitments(review_circle_id);

-- Person lookups
CREATE INDEX idx_decisions_sponsor ON decisions(sponsor_person_id);
CREATE INDEX idx_decisions_requested_by ON decisions(requested_by_person_id);
CREATE INDEX idx_commitments_owner ON commitments(owner_person_id);

-- Status filtering
CREATE INDEX idx_decisions_status ON decisions(status);
CREATE INDEX idx_commitments_status ON commitments(status);
CREATE INDEX idx_initiatives_status ON initiatives(status);

-- Project hierarchy
CREATE INDEX idx_projects_initiative ON projects(initiative_id);
CREATE INDEX idx_project_updates_project ON project_updates(project_id);

-- Activity events
CREATE INDEX idx_activity_events_workspace ON activity_events(workspace_id);
CREATE INDEX idx_activity_events_entity ON activity_events(entity_type, entity_id);
CREATE INDEX idx_activity_events_actor ON activity_events(actor_person_id);
CREATE INDEX idx_activity_events_created ON activity_events(created_at DESC);
```

## Updated_at trigger

All tables with `updated_at` use a shared trigger:

```sql
CREATE OR REPLACE FUNCTION update_updated_at()
RETURNS trigger AS $$
BEGIN
  NEW.updated_at = now();
  RETURN NEW;
END;
$$ LANGUAGE plpgsql;

-- Applied to each table:
CREATE TRIGGER set_updated_at BEFORE UPDATE ON workspaces
  FOR EACH ROW EXECUTE FUNCTION update_updated_at();
CREATE TRIGGER set_updated_at BEFORE UPDATE ON persons
  FOR EACH ROW EXECUTE FUNCTION update_updated_at();
-- ... (same for all tables with updated_at)
```

<Note>
  Django's `auto_now=True` on `DateTimeField` handles `updated_at` at the application level. The Postgres trigger is an additional safeguard for direct database operations.
</Note>
